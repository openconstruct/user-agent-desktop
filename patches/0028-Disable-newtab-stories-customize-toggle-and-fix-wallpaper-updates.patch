From d6ec2b481e1b79e65b8fb0aa99265c83ffa02a4f Mon Sep 17 00:00:00 2001
From: Jenkins <jenkins@magrathea>
Date: Sat, 21 Feb 2026 21:43:49 -0500
Subject: Disable newtab stories customize toggle and fix wallpaper
 updates

---
 .../content-src/components/Base/Base.jsx      |  5 +-
 .../ContentSection/ContentSection.jsx         | 97 ++-----------------
 .../WallpaperCategories.jsx                   | 20 ++--
 3 files changed, 23 insertions(+), 99 deletions(-)

diff --git a/browser/extensions/newtab/content-src/components/Base/Base.jsx b/browser/extensions/newtab/content-src/components/Base/Base.jsx
index 8438533ff8..6ba38199d4 100644
--- a/browser/extensions/newtab/content-src/components/Base/Base.jsx
+++ b/browser/extensions/newtab/content-src/components/Base/Base.jsx
@@ -466,7 +466,10 @@ export class BaseContent extends React.PureComponent {
       const regexRGB = /#([a-fA-F0-9]{6})/;
 
       // Override Remote Settings to set custom HEX bg color
-      if (selectedWallpaper.includes("solid-color-picker")) {
+      if (
+        typeof selectedWallpaper === "string" &&
+        selectedWallpaper.includes("solid-color-picker")
+      ) {
         wallpaper = {
           theme: wallpaper?.theme || "light",
           title: "solid-color-picker",
diff --git a/browser/extensions/newtab/content-src/components/CustomizeMenu/ContentSection/ContentSection.jsx b/browser/extensions/newtab/content-src/components/CustomizeMenu/ContentSection/ContentSection.jsx
index 5589f66971..2c5f91ce27 100644
--- a/browser/extensions/newtab/content-src/components/CustomizeMenu/ContentSection/ContentSection.jsx
+++ b/browser/extensions/newtab/content-src/components/CustomizeMenu/ContentSection/ContentSection.jsx
@@ -4,7 +4,6 @@
 
 import React from "react";
 import { actionCreators as ac } from "common/Actions.mjs";
-import { SectionsMgmtPanel } from "../SectionsMgmtPanel/SectionsMgmtPanel";
 import { WallpaperCategories } from "../../WallpaperCategories/WallpaperCategories";
 
 export class ContentSection extends React.PureComponent {
@@ -14,7 +13,6 @@ export class ContentSection extends React.PureComponent {
 
     // Refs are necessary for dynamically measuring drawer heights for slide animations
     this.topSitesDrawerRef = React.createRef();
-    this.pocketDrawerRef = React.createRef();
   }
 
   inputUserEvent(eventSource, eventValue) {
@@ -49,10 +47,19 @@ export class ContentSection extends React.PureComponent {
 
   componentDidMount() {
     this.setDrawerMargins();
+    if (this.props.enabledSections.pocketEnabled) {
+      this.props.setPref("feeds.section.topstories", false);
+    }
   }
 
-  componentDidUpdate() {
+  componentDidUpdate(prevProps) {
     this.setDrawerMargins();
+    if (
+      this.props.enabledSections.pocketEnabled &&
+      !prevProps.enabledSections.pocketEnabled
+    ) {
+      this.props.setPref("feeds.section.topstories", false);
+    }
   }
 
   setDrawerMargins() {
@@ -60,10 +67,6 @@ export class ContentSection extends React.PureComponent {
       `TOP_SITES`,
       this.props.enabledSections.topSitesEnabled
     );
-    this.setDrawerMargin(
-      `TOP_STORIES`,
-      this.props.enabledSections.pocketEnabled
-    );
   }
 
   setDrawerMargin(drawerID, isOpen) {
@@ -71,8 +74,6 @@ export class ContentSection extends React.PureComponent {
 
     if (drawerID === `TOP_SITES`) {
       drawerRef = this.topSitesDrawerRef.current;
-    } else if (drawerID === `TOP_STORIES`) {
-      drawerRef = this.pocketDrawerRef.current;
     } else {
       return;
     }
@@ -92,23 +93,16 @@ export class ContentSection extends React.PureComponent {
   render() {
     const {
       enabledSections,
-      pocketRegion,
-      mayHaveInferredPersonalization,
-      mayHaveRecentSaves,
       mayHaveWeather,
       openPreferences,
       wallpapersEnabled,
       activeWallpaper,
       setPref,
-      mayHaveTopicSections,
       exitEventFired,
     } = this.props;
     const {
       topSitesEnabled,
-      pocketEnabled,
       weatherEnabled,
-      showInferredPersonalizationEnabled,
-      showRecentSavesEnabled,
       topSitesRowsCount,
     } = enabledSections;
 
@@ -191,77 +185,6 @@ export class ContentSection extends React.PureComponent {
               </div>
             </moz-toggle>
           </div>
-
-          {pocketRegion && (
-            <div id="pocket-section" className="section">
-              <moz-toggle
-                id="pocket-toggle"
-                pressed={pocketEnabled || null}
-                onToggle={this.onPreferenceSelect}
-                aria-describedby="custom-pocket-subtitle"
-                data-preference="feeds.section.topstories"
-                data-eventSource="TOP_STORIES"
-                data-l10n-id="newtab-custom-stories-toggle"
-              >
-                <div slot="nested">
-                  {(mayHaveRecentSaves ||
-                    mayHaveInferredPersonalization ||
-                    mayHaveTopicSections) && (
-                    <div className="more-info-pocket-wrapper">
-                      <div
-                        className="more-information"
-                        ref={this.pocketDrawerRef}
-                      >
-                        {mayHaveInferredPersonalization && (
-                          <div className="check-wrapper" role="presentation">
-                            <input
-                              id="inferred-personalization"
-                              className="customize-menu-checkbox"
-                              disabled={!pocketEnabled}
-                              checked={showInferredPersonalizationEnabled}
-                              type="checkbox"
-                              onChange={this.onPreferenceSelect}
-                              data-preference="discoverystream.sections.personalization.inferred.user.enabled"
-                              data-eventSource="INFERRED_PERSONALIZATION"
-                            />
-                            <label
-                              className="customize-menu-checkbox-label"
-                              htmlFor="inferred-personalization"
-                            >
-                              Recommendations inferred from your activity with
-                              the feed
-                            </label>
-                          </div>
-                        )}
-                        {mayHaveTopicSections && (
-                          <SectionsMgmtPanel exitEventFired={exitEventFired} />
-                        )}
-                        {mayHaveRecentSaves && (
-                          <div className="check-wrapper" role="presentation">
-                            <input
-                              id="recent-saves-pocket"
-                              className="customize-menu-checkbox"
-                              disabled={!pocketEnabled}
-                              checked={showRecentSavesEnabled}
-                              type="checkbox"
-                              onChange={this.onPreferenceSelect}
-                              data-preference="showRecentSaves"
-                              data-eventSource="POCKET_RECENT_SAVES"
-                            />
-                            <label
-                              className="customize-menu-checkbox-label"
-                              htmlFor="recent-saves-pocket"
-                              data-l10n-id="newtab-custom-pocket-show-recent-saves"
-                            />
-                          </div>
-                        )}
-                      </div>
-                    </div>
-                  )}
-                </div>
-              </moz-toggle>
-            </div>
-          )}
         </div>
 
         <span className="divider" role="separator"></span>
diff --git a/browser/extensions/newtab/content-src/components/WallpaperCategories/WallpaperCategories.jsx b/browser/extensions/newtab/content-src/components/WallpaperCategories/WallpaperCategories.jsx
index 250bcc217c..591c1d4442 100644
--- a/browser/extensions/newtab/content-src/components/WallpaperCategories/WallpaperCategories.jsx
+++ b/browser/extensions/newtab/content-src/components/WallpaperCategories/WallpaperCategories.jsx
@@ -55,7 +55,6 @@ export class _WallpaperCategories extends React.PureComponent {
     this.state = {
       activeCategory: null,
       activeCategoryFluentID: null,
-      showColorPicker: false,
       inputType: "radio",
       activeId: null,
       isCustomWallpaperError: false,
@@ -368,7 +367,7 @@ export class _WallpaperCategories extends React.PureComponent {
     const prefs = this.props.Prefs.values;
     const { wallpaperList, categories } = this.props.Wallpapers;
     const { activeWallpaper } = this.props;
-    const { activeCategory, showColorPicker } = this.state;
+    const { activeCategory } = this.state;
     const { activeCategoryFluentID } = this.state;
     let filteredWallpapers = wallpaperList.filter(
       wallpaper => wallpaper.category === activeCategory
@@ -386,20 +385,19 @@ export class _WallpaperCategories extends React.PureComponent {
 
     let wallpaperCustomSolidColorHex = null;
 
-    const selectedWallpaper = prefs["newtabWallpapers.wallpaper"];
+    const selectedWallpaper = prefs["newtabWallpapers.wallpaper"] || "";
+    const hasCustomSolidColor =
+      typeof selectedWallpaper === "string" &&
+      selectedWallpaper.includes("solid-color-picker");
+    const showColorPicker =
+      prefs["newtabWallpapers.customColor.enabled"] || hasCustomSolidColor;
 
     // User has previous selected a custom color
-    if (selectedWallpaper.includes("solid-color-picker")) {
-      this.setState({ showColorPicker: true });
+    if (hasCustomSolidColor) {
       const regex = /#([a-fA-F0-9]{6})/;
-      [wallpaperCustomSolidColorHex] = selectedWallpaper.match(regex);
+      wallpaperCustomSolidColorHex = selectedWallpaper.match(regex)?.[0] || null;
     }
 
-    // Enable custom color select if pref'ed on
-    this.setState({
-      showColorPicker: prefs["newtabWallpapers.customColor.enabled"],
-    });
-
     // Remove last item of solid colors to make space for custom color picker
     if (
       prefs["newtabWallpapers.customColor.enabled"] &&
-- 
2.53.0

